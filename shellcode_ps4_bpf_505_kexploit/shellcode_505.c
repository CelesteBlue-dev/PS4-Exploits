/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 j_sycall_11_sub();
__int64 kpayload();
signed __int64 syscall_11_sub();

//-------------------------------------------------------------------------
// Data declarations

char *aKmalloc0x016lx[] = { (char *)0x3A636F6C6C616D6BLL, (char *)0x6C36313025783020LL };
__int64 qword_D0 = 0LL; // weak


//----- (0000000000000010) ----------------------------------------------------
__int64 kpayload()
{
  signed __int64 v0; // rcx
  signed int i; // ebx
  unsigned __int64 xfast_syscall; // r12
  signed __int64 kbase; // rdx
  __int64 (__fastcall *malloc)(unsigned __int64, __int64, unsigned int); // r14
  __int64 (__fastcall *printf)(__int64, __int64, __int64, __int64, __int64, __int64, char); // r13
  signed __int64 M_KQUEUE_offset; // r12
  __int64 malloc_res; // rsi

  v0 = 0xC0000082LL;
  i = 0x100;
  xfast_syscall = __readmsr(0xC0000082);
  kbase = xfast_syscall - 0x1C0;
  malloc = (__int64 (__fastcall *)(unsigned __int64, __int64, unsigned int))(xfast_syscall + 0x10E090);
  printf = (__int64 (__fastcall *)(__int64, __int64, __int64, __int64, __int64, __int64, char))(xfast_syscall + 0x435E80);
  M_KQUEUE_offset = xfast_syscall + 0x14B7160;
  qword_D0 = kbase;
  do
  {
    malloc_res = ((__int64 (__fastcall *)(signed __int64, signed __int64, signed __int64, signed __int64))malloc)(
                   0x800LL,
                   M_KQUEUE_offset,
                   2LL,
                   v0);
    ((void (__fastcall *)(char **, __int64))printf)(aKmalloc0x016lx, malloc_res);
    --i;
  }
  while ( i );
  return 0LL;
}
// D0: using guessed type __int64 qword_D0;

//----- (0000000000000090) ----------------------------------------------------
signed __int64 syscall_11_sub()
{
  signed __int64 result; // rax

  result = 11LL;
  __asm { syscall; Low latency system call }
  return result;
}

// ALL OK, 2 function(s) have been successfully decompiled
